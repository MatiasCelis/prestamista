<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mis PrÃ©stamos</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <header>
    <h1>ðŸ’¼ Mis PrÃ©stamos</h1>
    <nav>
      <button onclick="window.location.href='agregar.html'">+ Nuevo</button>
      <button onclick="window.location.href='cliente.html'">ðŸ‘¤ Cliente</button>
      <button id="logout">Salir</button>
    </nav>
  </header>

  <div>
    <select id="filtro">
      <option value="pendiente">Pendientes</option>
      <option value="pagado">Pagados</option>
      <option value="todos">Todos</option>
    </select>
  </div>

  <table id="tabla">
    <thead>
      <tr>
        <th>Monto</th>
        <th>%</th>
        <th>InterÃ©s</th>
        <th>Total</th>
        <th>PrÃ©stamo</th>
        <th>Vencimiento</th>
        <th>Estado</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script type="module">
    import { supabase } from './js/config.js';

    const tbody = document.querySelector('#tabla tbody');
    const filtro = document.getElementById('filtro');

    async function cargarPrestamos() {
      let query = supabase.from('prestamos').select('*').order('fecha_prestamo', { ascending: false });
      if (filtro.value !== 'todos') query = query.eq('estado', filtro.value);

      const { data, error } = await query;
      if (error) return alert(error.message);

      tbody.innerHTML = '';
      data.forEach(p => {
        const row = `
          <tr>
            <td>${p.monto.toLocaleString()}</td>
            <td>${p.interes_porcentaje}%</td>
            <td>${p.interes_monto.toLocaleString()}</td>
            <td>${p.total.toLocaleString()}</td>
            <td>${p.fecha_prestamo}</td>
            <td>${p.fecha_vencimiento}</td>
            <td>${p.estado}</td>
          </tr>`;
        tbody.innerHTML += row;
      });
    }

    filtro.addEventListener('change', cargarPrestamos);
    cargarPrestamos();

    document.getElementById('logout').addEventListener('click', async () => {
      await supabase.auth.signOut();
      window.location.href = 'login.html';
    });
  </script>
</body>
</html>
